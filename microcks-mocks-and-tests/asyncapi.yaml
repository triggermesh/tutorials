asyncapi: '2.6.0'
info:
  title: Mocks and tests for unified cloud storage nofications
  version: 0.1.0
  description: This AysynAPI definition is fed to microcks in order to create mocks and tests for a TriggerMesh project that creates unified cloud storage notifications
defaultContentType: application/json
channels:
  s3notifications:
    description: Provides S3 object notifications
    subscribe:
      summary: Subscribe to receive S3 object notifications
      operationId: receiveS3ObjectNotification
      message:
        description: An S3 object notification
        bindings:
          kafka:
            key:
              type: string
              description: Timestamp of event as milliseconds since 1st Jan 1970
        payload:
          $ref: 'https://raw.githubusercontent.com/triggermesh/triggermesh/main/schemas/com.amazon.s3.event.json'
        examples:
          - name: objectcreated
            payload:
              awsRegion: us-east-1
              eventName: ObjectCreated:Put
              eventSource: aws:s3
              eventTime: '2023-04-03T20:17:28.513Z'
              eventVersion: '2.1'
              requestParameters:
                sourceIPAddress: 88.170.205.78
              responseElements:
                x-amz-id-2: VMlFKbaL0zz0L3fO6gg8GVfPxhw4h68qXXVntIB9rXblQ4X+epMSO9Bfee+TMkeVVlO0Mr7I6A9wqZf4wgs5ESzLMjqZda6H
                x-amz-request-id: BTY94PVFE626AH9G
              s3:
                bucket:
                  arn: arn:aws:s3:::jmcx-dev
                  name: jmcx-dev
                  ownerIdentity:
                    principalId: A2MWJ7PRW7U41K
                configurationId: io.triggermesh.awss3sources.local.triggermesh-awss3source
                object:
                  eTag: a8d4fb3a57d904303dbc6ee2ae11efc3
                  key: MonaLisa-daVinci.jpeg
                  sequencer: 00642B345862164155
                  size: 61790
                s3SchemaVersion: '1.0'
              userIdentity:
                principalId: AWS:AIDAQUHRFMYW5IL6X72NI
  unifiedNotifications:
    description: Receives unified notifcations
    publish:
      summary: Consumes unified object storage notifications
      message: 
        description: A unified object storage notification
        payload:
          $ref: 'https://raw.githubusercontent.com/triggermesh/tutorials/microcks-mocks-and-tests/microcks-mocks-and-tests/io.triggermesh.objectStorage.objectCreated.json'
        bindings:
          kafka:
            key:
              type: string
              description: Timestamp of event as milliseconds since 1st Jan 1970